ğŸš€ FFT-Based Motion Detection on STM32F4Real-time motion classification using frequency-domain analysis on an STM32F4 (Cortex-M4) microcontroller.Instead of traditional threshold-based motion detection, this project implements a full DSP pipeline using CMSIS-DSP to analyze accelerometer signals in the frequency domain.## ğŸ“Œ OverviewThis project captures accelerometer data from the MPU-6050 over I2C and processes it using an optimized FFT pipeline to classify motion states such as:ğŸ§ StandingğŸš¶ WalkingğŸƒ RunningThe system leverages hardware FPU and DSP instructions available in the Cortex-M4 for efficient real-time signal processing.## ğŸ§  Why Frequency-Domain Motion Detection?Traditional motion detection:if(acceleration &gt; threshold) â†’ motion
This approach:Time Domain â†’ FFT â†’ Frequency Analysis â†’ Motion Classification
Advantages:Detects periodic motion patternsReduces noise sensitivityEnables activity classificationMore robust than simple thresholding## âš™ï¸ System Architecture### ğŸ”¹ HardwareSTM32F4 (Cortex-M4 with FPU)MPU-6050 Accelerometer (I2C)### ğŸ”¹ SamplingFixed sampling rate (e.g., 200â€“500 Hz)Buffer size: 256 samples (configurable)## ğŸ”¬ DSP Processing Pipeline### âœ” 1. Acceleration MagnitudeCompute combined motion intensity:|A| = âˆš(AxÂ² + AyÂ² + AzÂ²)
### âœ” 2. DC RemovalRemoves gravity (~1g DC component) so FFT focuses on motion dynamics.mean = Î£x / N
x[i] = x[i] - mean
### âœ” 3. Windowing (Hanning Window)Reduces spectral leakage before FFT:float window = 0.5f *
    (1.0f - arm_cos_f32((2.0f * PI * i) / (FFT_SIZE - 1)));
### âœ” 4. FFT (CMSIS-DSP)Using optimized Real FFT for Cortex-M4:arm_rfft_fast_f32(&amp;fft_instance, fft_input, fft_output, 0);
arm_cmplx_mag_f32(fft_output, fft_mag, FFT_SIZE/2);
Why RFFT instead of CFFT?Accelerometer data is real-valuedExploits conjugate symmetryReduces memory usageImproves execution speed### âœ” 5. RMS GatingRMS measures total signal energy:RMS = sqrt(mean(xÂ²))
If RMS is too small:No meaningful motionIgnore FFT peaksPrevent false triggers### âœ” 6. Band LimitingOnly analyze frequency range relevant to human motion.Eliminates:High-frequency noiseUnnecessary computation### âœ” 7. Peak Frequency DetectionExtract dominant motion frequency from magnitude spectrum.Time Domain â†’ Frequency Domain â†’ Peak Detection
### âœ” 8. Multi-Frame Stability FilteringMotion frequency must remain stable across 4 consecutive FFT windows.Prevents:Noise spikesFalse classification### âœ” 9. Overlap ProcessingInstead of discarding full buffer:Shift half-bufferReuse samplesImprove temporal resolutionResult:Smoother detectionFaster transitions## ğŸ“Š Motion Classification LogicConditionClassificationLow RMSStanding0.8â€“3.8 HzWalking3.8â€“10 HzRunning## ğŸš€ Key FeaturesReal-time FFT on STM32F4CMSIS-DSP optimized implementationEfficient memory usageNoise-resistant motion detectionMulti-frame stability filteringOverlap-based processingActivity classification## ğŸ› ï¸ Optimization TechniquesReal FFT instead of Complex FFTFPU accelerationBand-limited peak searchRMS gating to skip unnecessary computationReduced memory footprint## ğŸ“ˆ Future ImprovementsMachine learning-based classificationVibration analysis extensionPredictive maintenance applicationsFreeRTOS integrationUART streaming for visualizationSpectral feature extraction (centroid, bandwidth, kurtosis)## ğŸ§‘â€ğŸ’» What This Project DemonstratesEmbedded DSP implementationReal-time signal acquisitionFrequency-domain motion analysisEfficient MCU optimizationPractical use of CMSIS-DSP library## ğŸ·ï¸ KeywordsSTM32 Cortex-M4 CMSIS-DSP FFT Embedded Systems Signal Processing Motion Detection Edge Computing
